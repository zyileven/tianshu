# ============================================================================
# Tianshu (天枢) - 环境变量配置示例
# ============================================================================
#
# 使用方式：
#   1. 复制此文件为 .env: cp .env.example .env
#   2. 根据实际情况修改配置
#   3. 使用 docker-compose up -d 启动服务
#
# ============================================================================

# ----------------------------------------------------------------------------
# 应用配置
# ----------------------------------------------------------------------------
API_PORT=8000
WORKER_PORT=8001
MCP_PORT=8002
FRONTEND_PORT=80

LOG_LEVEL=INFO

# ----------------------------------------------------------------------------
# JWT 认证配置
# ----------------------------------------------------------------------------
# 重要：生产环境请修改为随机字符串！
# 生成方式: openssl rand -hex 32
JWT_SECRET_KEY=your-secret-key-change-in-production
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# ----------------------------------------------------------------------------
# CORS 配置
# ----------------------------------------------------------------------------
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:80

# ----------------------------------------------------------------------------
# GPU 配置
# ----------------------------------------------------------------------------
# GPU 数量（Docker 分配）
GPU_COUNT=1

# 可见的 GPU 设备（Backend，逗号分隔）
CUDA_VISIBLE_DEVICES=0

# 每个 GPU 的 Worker 数量
WORKER_GPUS=2

# Worker 批处理大小
MAX_BATCH_SIZE=4

# Worker 超时时间（秒）
WORKER_TIMEOUT=300

# Worker 内存限制（硬限制，超过此值容器会被 OOM Killer 杀死）
# 格式: 数字 + 单位（M/G），例如: 8G, 16G, 32G
# 建议根据服务器内存配置：
#   - 16GB 服务器: 8G
#   - 32GB 服务器: 16G
#   - 64GB 服务器: 32G
WORKER_MEMORY_LIMIT=16G

# Worker 内存软限制（保证最少可用内存）
# 建议设置为硬限制的 50-75%
WORKER_MEMORY_RESERVATION=8G

# ----------------------------------------------------------------------------
# 文件配置
# ----------------------------------------------------------------------------
# 最大文件大小（字节，0 表示不限制）
MAX_FILE_SIZE=0

# Nginx 文件上传大小限制（0 表示不限制）
NGINX_CLIENT_MAX_BODY_SIZE=0

# ----------------------------------------------------------------------------
# PDF 拆分配置（大文件并行处理）
# ----------------------------------------------------------------------------
# 是否启用 PDF 自动拆分（true/false）
PDF_SPLIT_ENABLED=true

# PDF 拆分阈值（页数）
# 超过此页数的 PDF 会自动拆分为多个子任务并行处理
# 建议值: 500-1000 页
PDF_SPLIT_THRESHOLD_PAGES=500

# PDF 拆分块大小（页数）
# 每个子任务处理的页数
# 建议值: 300-500 页（根据服务器内存调整）
PDF_SPLIT_CHUNK_SIZE=250

# ----------------------------------------------------------------------------
# 数据库配置
# ----------------------------------------------------------------------------
DATABASE_PATH=/app/data/db/mineru_tianshu.db

# ----------------------------------------------------------------------------
# 模型下载配置
# ----------------------------------------------------------------------------
# 模型下载源:
#   - auto: 自动选择（优先 ModelScope，失败后尝试 HuggingFace）
#   - modelscope: ModelScope（国内推荐）
#   - huggingface: HuggingFace
#   - local: 离线模式（本地联网下载，然后直接复制模型到服务器上使用，以实现服务器下载模型失败的问题）
MODEL_DOWNLOAD_SOURCE=auto

# HuggingFace 镜像地址（国内加速）
HF_ENDPOINT=https://hf-mirror.com

# MinerU 虚拟显存大小（GB，auto 表示自动检测）
# MINERU_VIRTUAL_VRAM_SIZE=6

# 离线模型外部目录（主机路径，需包含预下载的所有模型文件），仅用于离线部署 docker-compose.offline.yml
OFFLINE_MODELS_PATH=./models-offline

# ----------------------------------------------------------------------------
# RustFS 对象存储配置（可选）
# ----------------------------------------------------------------------------
# RustFS 是一个高性能对象存储服务，用于存储和分发图片
#
# 启用/禁用 RustFS（true=启用，false=禁用）
# - true:  使用 RustFS 存储图片（需要 CPU 支持 SSE4.1）
# - false: 使用本地文件服务（兼容所有 CPU）
#
# 默认: false（兼容旧 CPU）
RUSTFS_ENABLED=false

# RustFS 服务地址（容器内部）
RUSTFS_ENDPOINT=rustfs:9000

# RustFS 访问密钥（生产环境请修改！）
RUSTFS_ACCESS_KEY=rustfsadmin
RUSTFS_SECRET_KEY=rustfsadmin

# RustFS 存储桶名称
RUSTFS_BUCKET=ts-img

# RustFS 是否使用 HTTPS
RUSTFS_SECURE=false

# RustFS 公开访问 URL（外部访问地址）
#
# ⚠️  重要：仅在 RUSTFS_ENABLED=true 时需要配置
#     必须设置为外部可访问的完整 URL
#
# 配置示例:
#   - 局域网: RUSTFS_PUBLIC_URL=http://192.168.1.100:9000
#   - 公网: RUSTFS_PUBLIC_URL=http://your-domain.com:9000
#   - HTTPS: RUSTFS_PUBLIC_URL=https://files.your-domain.com
#   - Windows/WSL: 使用 Windows 主机的 IP (在 Windows 中运行 ipconfig 查看)
#
# 获取 Windows IP 的方法:
#   1. 在 Windows PowerShell 或 CMD 中运行: ipconfig
#   2. 找到 "IPv4 地址"，例如: 192.168.1.100
#   3. 设置: RUSTFS_PUBLIC_URL=http://192.168.1.100:9000
#
RUSTFS_PUBLIC_URL=http://192.168.1.100:9000

# RustFS 服务端口
RUSTFS_PORT=9000
RUSTFS_CONSOLE_PORT=9001

# ----------------------------------------------------------------------------
# MCP Server 配置（可选）
# ----------------------------------------------------------------------------
API_URL=http://backend:8000

# ----------------------------------------------------------------------------
# Redis 队列配置（可选 - 解决 SQLite 并发瓶颈）
# ----------------------------------------------------------------------------
# 是否启用 Redis 队列（true/false）
# 默认: false（使用 SQLite 队列）
# 启用后可以提升高并发场景下的性能
#
# 使用方式:
#   1. 设置 REDIS_QUEUE_ENABLED=true
#   2. 启动 Docker 时使用: docker-compose --profile redis up -d
#   3. 不使用 --profile redis 时，Redis 容器不会启动
#
REDIS_QUEUE_ENABLED=false

# Redis 服务器配置（仅在 REDIS_QUEUE_ENABLED=true 时生效）
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# ----------------------------------------------------------------------------
# 前端配置
# ----------------------------------------------------------------------------
VITE_API_BASE_URL=http://localhost:8000
